# 进程
> 是一个执行中的程序实例，是程序再内存中的一种映射，是操作系统资源管理的最小单位。

## 背景
### 多任务
操作系统可以同时运行多个任务。比如此刻我同时在听歌在浏览网页还在记云笔记，这就是多任务。 <br>

#### 多核CPU并行执行多任务
真正**并行**执行多任务只能在多核CPU实现，一个CPU对应一个任务。但实际运用中需要处理的任务数量是远远大于CPU核心数的。所以就算是多核CPU处理更多的任务的时候，也会把多个任务轮流调度到一个CPU核心上执行。

#### 单核CPU执行多任务
CPU执行代码都是顺序执行的。单核CPU执行多任务实际上就是操作系统让各任务**交替**执行（不是并行）。由于CPU的执行速率实在太快了，所以给我们的感觉就像是并行处理的。

## 上下文切换
> 上下文切换是指CPU从一个进程/线程切换到另一个线程/进程的过程。
> CPU通过时间片分配算法来循环执行任务，当前任务执行一个时间片后回切换到下一个任务，这里需要注意，在切换到下一个任务之前会保存上一个任务的状态，以便下次切换回这个任务时，可以再加载这个任务的状态。所以，切换任务时整个从保存任务到切换后再加载下个任务的过程就是一次上下文切换。
> > 上下文指的是某一时间点CPU寄存器和程序计数器的内容。 

### 寄存器 程序计数器
- 寄存器：是CPU内部数量较少但是速度很快的内存（与之对应的时CPU外部相对内部较慢的RAM主内存）。寄存器通常对常用值（通常是运算的中间值）的快速访问来提高计算机程序运行的速度。
- 程序计数器：是一个专用的寄存器，用于表明指令序列中CPU正在执行的位置，存的值为**正在执行的指令的位置或者下一个将要被执行的指令的位置**，具体依赖与操作系统。

## 进程
上面多任务的例子对于操作系统而言，一个任务就是一个**进程（Process）**。听歌是一个进程，浏览网页是一个进程，记笔记是一个进程。

## 线程
拿记云笔记这个进程来说，看似我们只是在记笔记，其实记笔记内部还有其他的事也在处理，比如即时同步，比如markdown预览页的即时生成。我们可以把同步笔记，生成预览页等记笔记的“子任务”称之为**线程（Thread）**。<br>
既然是任务，每个任务至少得做一件事才行。同理，每个进程也得至少做一件事，所以，**每个进程至少得有一个线程**。有些复杂得进程可能会有多个线程，多个线程的执行也像多个进程一样，又操作系统在多个线程之间来回切换，交替执行。同样，真正的多线程并行执行还是得需要多核CPU才能实现。

## 同时执行多个任务
- 多进程模式：启动多个进程(每个进程内一个线程)
- 多线程模式：启动一个进程，在进程内启动多个线程
- 多进程+多线程模式：启动多个线程，每个线程内启动多个进程