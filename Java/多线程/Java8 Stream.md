# Java Stream

> Java 8最主要的语言特性是lambda表达式。
>
> lambda表达式可以被理解成具有参数，主体和和返回类型的匿名方法（native method）。lambda表达式所实现的功能，使得用**行为表达数据**变得很容易。
>
> 比如filter，map等方法很容易就能看出来是做什么的。
>
> 流利用了强大的计算原理：组合。流通过适用简单的构建块（过滤、映射、排序、集合）来组合复杂的操作。
>
> 比起在数据源上更加临时的计算，通过流的查询更能保留写入和读取的简单性。

## 流管道

> 所有关于流的计算都有一种共同的结构：他们具有一个流来源，0个或多个中间操作，以及一个终止操作。
>
> 流的元素可以是对象的引用（Stream<String>），也可以是基础数据类型（IntStream、LongStream）。

### 流来源

> 存储的数据。
>
> Java中大部分数据都存储在集合中，所以大多流计算使用集合作为流来源（Collection.stream()）。但是数据也可能存放在其他地方，比如数组，函数或者工厂方法，所以JDK提供了许多其他的方法来创建流（Stream.of(T...)，Stream.of(T[])...）。

### 中间操作

> 中间操作负责将一个流转换为另一个流。
>
> 中间操作包括:
>
> - filter()：选择与条件匹配的元素
> - map()：根据函数来转换元素
> - flatMap()：将提供的流处理函数应用于流元素后获得的流元素
> - distinct()：去除重复元素
> - limit()：在指定大小出截断流
> - sorted()：排序
> - skip()：丢弃指定数量的流元素

中间操作是**惰性的**：调用中间操作会设置流管道的下一个阶段，不会有其他任何操作，所以我们常在中间操作后跟上一个终止操作对数据做处理。

中间操作可以进一步划分为**无状态操作**和**有状态操作**。

- 无状态操作：可独立处理每个元素，比如filter()和map();
- 有状态操作：可在合并以前看到影响其他元素处理的元素状态，比如sorted()和distinct()；

### 终止操作

> 对数据集的处理是在执行终止操作时开始的，比如collect()，sum()，min()，max()等。
>
> 需要注意，**执行终止操作的同时会终止流管道**，如果在执行终止操作后我们还想再次处理同一个数据集，需要重新设置一个流管道。
>
> 终止操作包括：
>
> - forEach()：将要执行的操作应用于流的每个元素；
> - toArray()：使用流的元素创建一个数组；
> - reduce()：将流的元素聚合为一个汇总值；
> - collect()：将流的元素聚合到一个汇总容器中；
> - min()：通过比较符返回流的最小元素；
> - max()：返回流的最大元素；
> - count()：返回流的大小；
> - anyMatch/noneMatch/allMatch：返回是否存在与预期相匹配的流元素；
> - findFirst/findAny：如果存在，返回指定（第一/任意）元素；